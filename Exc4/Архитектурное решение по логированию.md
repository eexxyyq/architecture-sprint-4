# Архитектурное решение по логированию

## Сервисы, для которых необходимо настроить логирование:
1. **MES API** — система обработки заказов на производстве.
2. **CRM API** — система управления отношениями с клиентами.
3. **Shop API** — интерфейс интернет-магазина.

## Логирование должно быть настроено для следующих типов событий:
1. **Заказы**: создание, изменение статуса, присвоение оператора.
2. **Модели**: отправка и изменение статусов 3D-моделей.
3. **Пользователи**: регистрация, авторизация, история заказов.
4. **Ошибки и исключения**: сбои и ошибки на уровне бизнес-логики.
5. **API-вызовы**: время ответа, количество запросов, ошибки.

## Примеры логов с уровнем INFO:
1. **Изменение статуса заказа**:
    - Время события
    - Идентификатор клиента
    - Номер заказа
    - Старый и новый статус заказа

2. **Отправка модели**:
    - Время отправки
    - Идентификатор модели
    - Статус модели (успешно отправлено/ошибка)

3. **Регистрация пользователя**:
    - Время регистрации
    - Идентификатор пользователя
    - Источник регистрации (например, веб-сайт, мобильное приложение)

4. **Обработка API-запроса**:
    - Время запроса
    - Метод API
    - Параметры запроса
    - Время ответа

5. **Ошибки и сбои в бизнес-логике**:
    - Время возникновения ошибки
    - Тип ошибки
    - Идентификатор запроса или операции

## Другие уровни логирования

### Уровень DEBUG:
Используется для детального анализа и отладки:
- Входные и выходные значения функций.
- Условия ветвлений в коде.
- Продолжительность операций.

### Уровень ERROR:
Используется для логирования критических ошибок и сбоев:
- Ошибки на уровне системы или интерфейса.
- Проблемы с базой данных или API.
- Несоответствие данных бизнес-логике.

### Уровень WARN:
Используется для предупреждений, которые не являются критичными, но могут повлиять на производительность или функциональность:
- Задержки в обработке запросов.
- Падение производительности.

## Мотивация

### Зачем нужно добавить логирование?
1. **Упрощение диагностики проблем**: Логирование поможет быстрее понять причины возникновения ошибок, позволяя сократить время на разбор инцидентов.
2. **Снижение нагрузки на поддержку**: Специалисты поддержки смогут оперативно получить информацию о статусе системы и выявить источник проблемы.
3. **Ускорение времени отклика на инциденты**: Быстрое выявление проблем с помощью логов улучшит реакцию команды на инциденты.

### Влияние логирования на бизнес-метрики:
1. **MTTR (Mean Time to Resolution)** — сокращение времени на устранение инцидентов.
2. **Количество жалоб от клиентов** — уменьшение числа жалоб за счет более быстрой диагностики и исправления ошибок.
3. **Производительность системы** — улучшение за счет мониторинга и своевременного выявления узких мест.
4. **Удовлетворенность клиентов** — повышение удовлетворенности клиентов из-за улучшения качества обслуживания.

## Предлагаемое решение

### Реализация логирования

Для реализации логирования будет использован **ELK Stack** (Elasticsearch, Logstash, Kibana), который позволяет собирать, хранить и анализировать логи.

#### Структура логирования:
1. **Logback** для **Java**-сервисов.
2. **Serilog** для **C#**-сервисов.
3. **Logstash** для агрегации и отправки логов в **Elasticsearch**.
4. **Kibana** для визуализации логов и мониторинга.

#### Архитектурное решение:
- Логи будут собираться из всех сервисов (MES API, CRM API, Shop API) с уровнями INFO, DEBUG и ERROR.
- Логи будут передаваться в **Elasticsearch** с помощью **Logstash** для хранения и агрегации.
- Для анализа и мониторинга будет использоваться **Kibana**.

### Политика безопасности

1. **Чувствительные данные**: Все личные данные и пароли будут исключены или маскированы в логах.
2. Доступ к логам будет ограничен только разработчиками и технической поддержкой на продакшн-окружении.

### Политика хранения логов

- Логи будут храниться в **Elasticsearch** в отдельных индексах для каждой системы.
- Логи будут храниться не менее 30 дней.
- Для экономии места логи будут сжаты.

### Система анализа логов

1. **Алерты**: Настроим алерты для критичных ошибок, таких как 500 ошибки в API или падения системы.
2. **Аномалии**: Используем возможности Kibana для поиска аномальных пиков, например, резкий рост запросов, который может указывать на DDoS-атаку.