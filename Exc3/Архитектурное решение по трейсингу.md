# Архитектурное решение по трейсингу

## Мотивация

Введение трейсинга поможет:

- **Увеличить скорость разрешения проблем** — быстро выявлять сбои на каждом этапе.
- **Повышение качества обслуживания** — быстрее решать проблемы с заказами.
- **Повышение надежности системы** — выявлять узкие места и масштабировать их.
- **Управление бизнес-метриками** — отслеживать время выполнения заказов и процент успешных.

**Метрики, которые улучшатся**:
1. Среднее время доставки заказа.
2. Процент успешных заказов.
3. Производительность системы.
4. Удовлетворенность клиентов.
5. Надежность системы.

## Предлагаемое решение

1. **Интеграция OpenTelemetry/Jaeger**:
    - Установить агентов трейсинга на сервисы (API, базы данных, очереди сообщений).
    - Использовать Jaeger для визуализации данных.

2. **Обновления архитектуры**:
    - Добавить компоненты для трейсинга и обновить связи между сервисами.

3. **Автоматический мониторинг и алертинг**:
    - Система будет мониторить состояние заказов и генерировать алерты, если заказ задерживается.
    - Интеграция с Prometheus + Alertmanager для алертов.

## Компромиссы

1. **Метрики, на которые трейсинг не повлияет**:
   - **Нагрузочное тестирование и производительность**: Трейсинг помогает отслеживать отдельные запросы и процессы в рамках текущей работы системы, но он не даёт информации о том, как система будет вести себя при нагрузке, если речь идет о масштабировании или стресс-тестах.
   - **Производительность кэширования**: Трейсинг не всегда покажет, как эффективно используется кэш, так как это скорее отдельная проблема производительности, требующая специфической настройки мониторинга.
   - **Проблемы с физическим оборудованием**: Если система сталкивается с аппаратными проблемами (например, отказ серверов или сети), трейсинг, ориентированный на логику процессов и данных, не поможет локализовать проблему.
   - **Ошибка в алгоритмах обработки данных или бизнес-логике**: Трейсинг не всегда способен выявить ошибки, связанные с некорректной работой алгоритмов или бизнес-логики, если они не приводят к явно зафиксированным исключениям или проблемам с производительностью.

2. **Когда трейсинг может быть неэффективным**:
   - **Микросервисы, работающие без явной асинхронности**: Если система основана на синхронных взаимодействиях и нет сложных процессов передачи сообщений, трейсинг может не принести особой пользы в отслеживании заказа, так как информация о состоянии процесса будет уже достаточно прозрачной.
   - **Тяжелая интеграция с внешними сервисами**: В случае использования проприетарных или сторонних систем, которые не предоставляют необходимых API для интеграции с инструментами трейсинга, его внедрение может быть дорогостоящим и технически сложным.
   - **Локальные ошибки в компонентах с низким уровнем взаимодействия**: Если какой-то компонент системы работает автономно и не имеет сложных взаимодействий с другими микросервисами, трейсинг может не быть полезным для отслеживания его состояния. Это относится к компонентам, которые не генерируют событий или запросов, влияющих на общий процесс заказа.

## Безопасность

1. **Аутентификация и авторизация**:
    - Доступ только для сотрудников с актуальной учетной записью и ролью "Поддержка".
2. **Контроль доступа**:
    - Ограничение доступа и логирование действий.

## Ссылка на обновленную диаграмму:

[Ссылка на диаграмму с4](jewerly_c4_model.drawio)